---
title: Установка AdGuard Home на роутеры Keenetic
date: 2020-12-13
categories: [adguardhome, adguard, dns, keenetic]
---

Нужно понимать, что блокировка рекламы с помощью блокировки доменов никогда не будет столь же эффективным способом борьбы с рекламой, как AdblockPlus/uBlock в браузере. Бывают случаи, когда реклама загружается с того же домена, что и полезный контент. Либо адреса рекламных доменов меняются так часто, что их невозможно блокировать все (YouTube). Браузерные дополнения борются с этим, скрывая такую рекламу непосредственно перед отрисовкой на экране, чего роутер сделать, по понятным причинам, не может. Тем не менее, блокировка рекламы с помощью блокировки доменов имеет смысл — например, если на клиентском устройстве реклама показывается в какой-нибудь мобильной игре или приложении, куда браузерный Adblock не установишь. Просто не нужно ожидать, что такая блокировка будет настолько же хороша, как при использовании AdblockPlus/uBlock и торопиться удалять эти дополнения из браузера.

1. Установите поддержку репозитория Entware по [инструкции](https://help.keenetic.com/hc/ru/articles/360021214160-Установка-системы-пакетов-репозитория-Entware-на-USB-накопитель).

2. Установите AdGuard Home:
```
opkg update
opkg install adguardhome-go
```

3. Отключите DNS-сервер, встроенный в прошивку Keenetic. Подключитесь к [CLI](https://help.keenetic.com/hc/ru/articles/213965889-Интерфейс-командной-строки-CLI-интернет-центра) (не путайте с SSH-сервером из Entware, который на порту 222):
```
opkg dns-override
system configuration save
```
после этого пропадёт доступ в Интернет, это нормально (ведь родной dns-proxy кинетика вы только что отключили, а AdGuard Home займёт его место лишь после прохождения первоначальной настройки).

4. Запустите AdGuard Home:
```
/opt/etc/init.d/S99adguardhome start
````

5. Откройте в браузере мастер первоначальной настройки AdGuard Home по адресу `http://IP-адрес-роутера:3000`. В дальнейшем будем считать, что этот адрес — `http://192.168.1.1:3000`

6. Произведите первоначальную настройку. Веб-интерфейс повесьте на `Все интерфейсы`, порт `1234`, DNS-сервер повесьте на `Все интерфейсы`, порт `53`. Также придумайте логин и пароль (чтобы не усложнять, можно использовать логин/пароль от админки роутера).

7. Зайдите по адресу `http://IP-адрес-роутера:1234` (в нашем примере — `http://192.168.1.1:1234`) и настройте остальное (подписки, фильтры, upstream DNS) по вкусу.


# Решение популярных проблем
## Не обновляются подписки по HTTPS
При установке AdGuard Home должен был автоматически установиться пакет `ca-bundle`, если он не установлен, то установите его (либо можно установить пакет `ca-certificates`):
```
opkg update
opkg install ca-bundle
```

## Периодически перестают открываться веб-страницы. В веб-интерфейсе управления роутером видна загрузка процессора на 98-99%
Отключите в настройках AdGuard Home безопасную навигацию и родительский контроль. Если поможет, то это означает, что процессор роутера не справляется с нагрузкой, создаваемой этими функциями.

## Использование с VPN Antizapret
1) убедитесь, что Antizapret настроен [по этой инструкции](https://t.me/FuckYouRKN/7).

2) в «http://192.168.1.1:1234/#dns → Upstream DNS-серверы» удалите все имеющиеся там адреса и впишите те, которые вы указывали в профилях «Системный» и «AntiZapret».

## Добавление домена в белый список
Почитайте про пользовательские фильтры в раздел настроек «Фильтры → Пользовательское правило фильтрации» и добавьте туда фильтр, который разблокирует доступ к нужному вам домену.

## Удаление AdGuard Home:
1) остановите его:
```
/opt/etc/init.d/S99adguardhome stop
```

2) удалите AdGuard Home:
```
opkg remove adguardhome-go
```

3) включите DNS-сервер, встроенный в прошивку Keenetic. Подключитесь к [CLI](https://help.keenetic.com/hc/ru/articles/213965889-Интерфейс-командной-строки-CLI-интернет-центра) (не путайте с SSH-сервером из Entware, который на порту 222):
```
no opkg dns-override
system configuration save
```
